---
title: "Summer in Italy: A Seasonal Analysis of Airbnb Trends"
author: Luke Checchio
date: Fall 2024
output: pdf_document
execute:
  echo: false
  warning: false
  message: false
---

```{r}
#| label: load-packages
#| echo: FALSE
#| warning: FALSE
#| messages: FALSE

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(tidymodels))
suppressPackageStartupMessages(library(sf))
suppressPackageStartupMessages(library(lme4))
suppressPackageStartupMessages(library(MuMIn))
suppressPackageStartupMessages(library(patchwork))
```

```{r}
#| label: load-data
#| echo: FALSE
#| warning: FALSE
#| messages: FALSE

city_grouped <- read.csv("data/airbnb_italian_city_grouped.csv") # good for EDA
neighbourhood_grouped <- read.csv("data/airbnb_italian_neighbourhood_grouped.csv") # good for EDA
city_data <- read.csv("data/airbnb_italy_city.csv") |>
  mutate(across(where(is.character), str_to_lower))
neighborhoods_geo <- st_read("data/airbnb_italy_city_neighbourhoods_geojson.geojson", quiet = T) |>
  mutate(across(where(is.character), str_to_lower))
```

# 1. Introduction

## 1.1 Motivation

After dropping to historic lows in the midst of the COVID-19 pandemic, travel is well on track to recover to pre-2020 levels. These trends show no sign of a slowing, and by 2030, international travel is expected to reach 9 billion lodging nights per year (McKinsey & Company).Since the advent of Airbnb, the landscape of short-term lodging and tourism has transformed dramatically, providing an unprecedented array of choices for travelers and a novel source of income for property owners. Italy, with its rich cultural heritage and popular tourist destinations, has seen significant growth in Airbnb listings, particularly in major cities and tourist hubs. In fact, today, Airbnb accounts for the second largest share of online bookings within the country, at a nearly 30% market share (Statista). The dynamics of pricing within the Italian Airbnb market, however, remain complex and subject to various influences, including seasonal fluctuations which significantly impact both availability and cost.

The interplay between seasonality and pricing is critical in tourism-centric economies like Italy's, where different regions experience peak tourist seasons at various times of the year. For example, coastal areas see a surge during summer months, while cities rich in art and history, such as Florence and Rome, typically can attract visitors year-round. Understanding these patterns is essential not only for economic forecasting and business planning for hosts but also for policy-making in tourism management.

This research project aims to delve into the seasonal trends in Airbnb pricing across Italy, exploring connections across 5 major Italian tourist hubs. By analyzing a comprehensive dataset of Airbnb listings that includes detailed pricing information, review scores, host details, and more from December 2023 to September 2024, this study seeks to uncover insights that could inform more strategic pricing and marketing decisions for Airbnb hosts and provide policymakers with data to better understand the economics of short-term rentals. The findings aim to contribute to the broader discourse on sustainable tourism in Italy, balancing economic benefits with community impacts and long-term viability.

## 1.2 Dataset and Variables

```{r}
#| label: data-modification-split

city_data <- city_data |>
  group_by(id) |>
  mutate(relative_price = price / mean(price), prop_reviews = number_of_reviews / sum(number_of_reviews), n = n())

city_data <- city_data |>
  group_by(place) |>
  mutate(relative_lat = abs(latitude - mean(latitude)), relative_long = abs(longitude - mean(longitude)))

city_data$log_price <- log(city_data$price)

firenze_data <- city_data |> filter(place == "firenze")
milano_data <- city_data |> filter(place == "milano")
napoli_data <- city_data |> filter(place == "napoli")
roma_data <- city_data |> filter(place == "roma")
venezia_data <- city_data |> filter(place == "venezia")
```

Data in this study were scraped from Airbnb's website on a quarterly basis from December 2023 to September 2024, with each round of data collection corresponding to one season in the dataset. The five major cities included in this analysis were Florence, Milan, Naples, Rome, and Venice; within each round of scraping, all Airbnb listings within the metropolitan area were recorded according to a unique identifier. This identifier remained the same across all data collection rounds, so that observations from the same listing could easily be recognized. Along with the listing identifier, the price at time of scraping, host's "superhost" status (used by Airbnb to identify and promote outstanding hosts), neighbourhood and coordinates of the listing, room type, max possible guests, review rating, city, and season were identified, among other variables. In all, 245,035 separate entries were recorded, across 89,306 totally Airbnb listings.

Several modifications were made to the dataset to make for an easier analysis of the relevant variables. First, the response variable of interest, price, was heavily right-skewed with some extreme high outliers (as well as low outliers, albeit less extreme); to address this issue, the price variable underwent a log transformation. Upon transforming the price in this way, it followed a distribution that was much more suitable for regression (see further details in Exploratory Analysis and Appendix). Furthermore, while it seemed important to include location in our analysis, it was initially unclear what the best way to go about this would be. The neighbourhood variable presented a convenient way of grouping Airbnb's in a similar geographic location within a city, but the number of neighbourhoods varied wildly across the 5 cities and quickly could quickly become unwwieldy if attempting to encode each as it's own predictor, with as many as 114 neighbourhoods in a single city, as was the case with Venice. For this reason, it was decided to adopt a single standardized form of incorporating location data within a city, termed relative latitude and relative longitude. These measures recorded the absolute deviation from the average latitude and longitude for all Airbnbs within the same city respectively. 

## 1.3 Exploratory Analysis

```{r}
#| label: response-distribution

# change to ggplot
price <- plot(density(city_data$price))
log_price <- plot(density(city_data$log_price))

price + log_price
```


# 2. Methodology

## 2.1 Model and Variable Selection

```{r}
#| label: model-fitting

city_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + place + period*place + (1 | id), data = city_data)
firenze_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + (1 | id), data = firenze_data)
milano_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + (1 | id), data = milano_data)
napoli_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + (1 | id), data = napoli_data)
roma_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + (1 | id), data = roma_data)
venezia_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + (1 | id), data = venezia_data)
```


These new measures allowed us to incorporate location relative to city center, which seemed highly relevant in the context of modeling Airbnb prices. In general, one might expect that the closer a listing is to the center of a city, the higher the price ought to be, due to 

## 2.2 Model Assumptions

# 3. Results

# 4. Discussion

\newpage

# Appendix

## References

https://www.mckinsey.com/industries/travel-logistics-and-infrastructure/our-insights/now-boarding-faces-places-and-trends-shaping-tourism-in-2024

https://www.statista.com/forecasts/1000846/hotel-private-accommodation-online-bookings-by-brand-in-italy

https://www.kaggle.com/datasets/salvatoremarcello/italian-airbnb-dataset?select=airbnb.csv

*Put citations here*

## Additional Exploratory Data Analysis

*Put EDA here*

## Model Investigation

### Firenze Model

```{r}
#| label: model-checking-firenze

# model summary output
summary(firenze_lmer)

# model anova
anova(firenze_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(firenze_lmer)

# model residual vs. fitted plot
plot(fitted(firenze_lmer), resid(firenze_lmer))

# model qq plot
qqnorm(resid(firenze_lmer))
qqline(resid(firenze_lmer))

# model residual density plot
plot(density(resid(firenze_lmer)))
```

### Milano Model

```{r}
#| label: model-checking-milano

# model summary output
summary(milano_lmer)

# model anova
anova(milano_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(milano_lmer)

# model residual vs. fitted plot
plot(fitted(milano_lmer), resid(milano_lmer))

# model qq plot
qqnorm(resid(milano_lmer))
qqline(resid(milano_lmer))

# model residual density plot
plot(density(resid(milano_lmer)))
```

### Napoli Model

```{r}
#| label: model-checking-napoli

# model summary output
summary(napoli_lmer)

# model anova
anova(napoli_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(napoli_lmer)

# model residual vs. fitted plot
plot(fitted(napoli_lmer), resid(napoli_lmer))

# model qq plot
qqnorm(resid(napoli_lmer))
qqline(resid(napoli_lmer))

# model residual density plot
plot(density(resid(napoli_lmer)))
```

### Roma Data

```{r}
#| label: model-checking-roma

# model summary output
summary(roma_lmer)

# model anova
anova(roma_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(roma_lmer)

# model residual vs. fitted plot
plot(fitted(roma_lmer), resid(roma_lmer))

# model qq plot
qqnorm(resid(roma_lmer))
qqline(resid(roma_lmer))

# model residual density plot
plot(density(resid(roma_lmer)))
```

### Venezia Model

```{r}
#| label: model-checking-venezia

# model summary output
summary(venezia_lmer)

# model anova
anova(venezia_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(venezia_lmer)

# model residual vs. fitted plot
plot(fitted(venezia_lmer), resid(venezia_lmer))

# model qq plot
qqnorm(resid(venezia_lmer))
qqline(resid(venezia_lmer))

# model residual density plot
plot(density(resid(venezia_lmer)))
```

### All Cities Model

```{r}
#| label: model-checking-all

# model summary output
summary(city_lmer)

# model anova
anova(city_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(city_lmer)

# model residual vs. fitted plot
plot(fitted(city_lmer), resid(city_lmer))

# model qq plot
qqnorm(resid(city_lmer))
qqline(resid(city_lmer))

# model residual density plot
plot(density(resid(city_lmer)))
```

