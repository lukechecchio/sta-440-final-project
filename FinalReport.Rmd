---
title: "Summer in Italy: A Seasonal Analysis of Airbnb Trends"
author: Luke Checchio
date: Fall 2024
output: 
  pdf_document:
    fig_caption: yes
execute:
  echo: false
  warning: false
  message: false
---

```{r}
#| label: load-packages

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(tidymodels))
suppressPackageStartupMessages(library(sf))
suppressPackageStartupMessages(library(lme4))
suppressPackageStartupMessages(library(MuMIn))
suppressPackageStartupMessages(library(patchwork))
suppressPackageStartupMessages(library(knitr))

opts_chunk$set(echo = F, warning = F, message = F, fig.width = 4, fig.height = 3, fig.show = "asis")
```

```{r}
#| label: load-data

city_grouped <- read.csv("data/airbnb_italian_city_grouped.csv") |>
  mutate(across(where(is.character), str_to_lower))
neighbourhood_grouped <- read.csv("data/airbnb_italian_neighbourhood_grouped.csv") |>
  mutate(across(where(is.character), str_to_lower))
city_data <- read.csv("data/airbnb_italy_city.csv") |>
  mutate(across(where(is.character), str_to_lower))
neighbourhoods_geo <- st_read("data/airbnb_italy_city_neighbourhoods_geojson.geojson", quiet = T) |>
  mutate(across(where(is.character), str_to_lower))
city_neighbourhoods <- read.csv("data/airbnb_italy_city_neighbourhoods.csv") |>
  mutate(across(where(is.character), str_to_lower))
```

# 1. Introduction

## 1.1 Motivation

After dropping to historic lows in the midst of the COVID-19 pandemic, travel is well on track to recover to pre-2020 levels. These trends show no sign of a slowing, and by 2030, international travel is expected to reach 9 billion lodging nights per year (McKinsey & Company).Since the advent of Airbnb, the landscape of short-term lodging and tourism has transformed dramatically, providing an unprecedented array of choices for travelers and a novel source of income for property owners. Italy, with its rich cultural heritage and popular tourist destinations, has seen significant growth in Airbnb listings, particularly in major cities and tourist hubs. In fact, today, Airbnb accounts for the second largest share of online bookings within the country, at a nearly 30% market share (Statista). The dynamics of pricing within the Italian Airbnb market, however, remain complex and subject to various influences, including seasonal fluctuations which significantly impact both availability and cost.

The interplay between seasonality and pricing is critical in tourism-centric economies like Italy's, where different regions experience peak tourist seasons at various times of the year. For example, coastal areas see a surge during summer months, while cities rich in art and history, such as Florence and Rome, typically can attract visitors year-round. Understanding these patterns is essential not only for economic forecasting and business planning for hosts but also for policy-making in tourism management.

This research project aims to delve into the seasonal trends in Airbnb pricing across Italy, exploring connections across 5 major Italian tourist hubs. By analyzing a comprehensive dataset of Airbnb listings that includes detailed pricing information, review scores, host details, and more from December 2023 to September 2024, this study seeks to uncover insights that could inform more strategic pricing and marketing decisions for Airbnb hosts and provide policymakers with data to better understand the economics of short-term rentals. The findings aim to contribute to the broader discourse on sustainable tourism in Italy, balancing economic benefits with community impacts and long-term viability.

## 1.2 Dataset and Variables

```{r}
#| label: data-modification-split

city_data <- city_data |>
  group_by(id) |>
  mutate(relative_price = price / mean(price), prop_reviews = number_of_reviews / sum(number_of_reviews), n = n())

city_data <- city_data |>
  group_by(place) |>
  mutate(relative_lat = abs(latitude - mean(latitude)), relative_long = abs(longitude - mean(longitude)))

city_data$log_price <- log(city_data$price)

firenze_data <- city_data |> filter(place == "firenze")
milano_data <- city_data |> filter(place == "milano")
napoli_data <- city_data |> filter(place == "napoli")
roma_data <- city_data |> filter(place == "roma")
venezia_data <- city_data |> filter(place == "venezia")
```

The dataset used for this study comprises Airbnb listing records from five major Italian cities: Florence, Milan, Naples, Rome, and Venice. Data were methodically scraped on a quarterly basis from December 2023 to September 2024 to capture seasonal variations in listing attributes, correlating each data collection round with one of the four seasons. This temporal alignment lends itself to a detailed examination of how seasonal factors influence Airbnb pricing, amongst other variables.

Data collection was conducted using a consistent unique identifier for each listing across all scraping sessions, facilitating longitudinal analysis of the same properties over time. Each record includes the listing price at the time of scraping, whether the host is designated as a "superhost" (a status awarded by Airbnb to hosts recognized for exceptional service), the neighborhood and precise coordinates of the listing, room type, maximum guest capacity, aggregate review scores, the city of the listing, and the season during which the data were collected. In total, the dataset encompasses 245,035 individual entries across 89,306 unique Airbnb listings.

Significant steps were undertaken to prepare and refine the dataset for analysis The price variable exhibited a right-skewed distribution with several extreme outliers; to address this, a logarithmic transformation was applied to normalize the data using the natural logarithm, significantly improving its suitability for regression analysis (details are elaborated in the Exploratory Analysis section and the Appendix). Additionally, the initial exploration revealed challenges in incorporating location data due to the high variability and large number of neighborhoods—up to 114 in Venice alone. To streamline the analysis and avoid the pitfalls of overfitting, standardized location metrics termed relative latitude and relative longitude were developed. These metrics measure each listing’s deviation from the average latitude and longitude of all listings within the same city, respectively, providing a standardized approach to quantify location effects within cities.

Additional datasets containing the same underlying data but grouped by city and neighbourhood as well as neighbourhood and city geospatial data for visualization purposes were used in exploratory analysis, but not ultimately included in the model fit.

## 1.3 Exploratory Analysis

Initial exploratory data analysis was conducted on a number of variables from the dataset to uncover potential trends in the data as well as to help guide variable selection for the eventual model.

```{r}
#| label: response-distribution
#| fig.cap: "Airbnb Log-Price Distribution"

ggplot(city_data, aes(x = log_price)) +
  geom_density(color = "#008C45", fill = "#83F0B9", size = 1.1) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold") 
  ) +
  labs(
    title = "Distribution of Log-transformed Airbnb prices in Italy",
    x = "Log-price",
    y = "Density"
  )
```

The plot above shows the log-transformed distribution of Airbnb prices in Italy. The transformation normalizes the price data, making it easier to observe common price points and variability. A similar plot of the prices prior to log-transformation is included in the Appendix, where it is clear that the distribution exhibits a heavy right-skew.

```{r}
#| label: seasonal-price-rome
#| fig.cap: "Median Airbnb Price Distribution by Neighbourhood, Season (Rome)"

neighbourhoods_geo <- neighbourhoods_geo |>
  left_join(city_neighbourhoods, by = "neighbourhood") |>
  transmute(neighbourhood = neighbourhood, city = city.y, 
            neighbourhood_group = neighbourhood_group.x, geometry = geometry)

grouped_neighbourhoods_full <- neighbourhoods_geo |>
  right_join(neighbourhood_grouped, by = c("neighbourhood" = "neighbourhood", "city" = "place")) |>
  group_by(neighbourhood, city, period) |>
  mutate(period_price = mean(price_median)) |>
  ungroup()

grouped_neighbourhoods_full <- grouped_neighbourhoods_full |>
  mutate(period = case_when(period == "early spring" ~ "Spring",
                            period == "early autumn" ~ "Fall",
                            period == "early summer" ~ "Summer",
                            period == "early winter" ~ "Winter"))

grouped_neighbourhoods_full$period <- factor(grouped_neighbourhoods_full$period, 
                                             levels = c("Spring", "Summer", "Fall", "Winter"))

ggplot(grouped_neighbourhoods_full |> filter(city == "roma")) + 
  geom_sf(aes(fill = price_median)) +
  facet_grid(~ period) +
  scale_fill_gradient(low = "#f2d8d9", high = "#CD212A") +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold"),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank()
  ) +
  labs(
    title = "Neighbourhood median Airbnb price by season, Rome",
    fill = "Median price (Euro)"
  )
```

The above plot displays a series of adjacent maps illustrating the median Airbnb prices by neighborhood across different seasons in Rome. The maps use a color gradient from light pink to dark red to depict the range of median prices in euros, with darker shades indicating higher prices. From the visualization, it seems that across most neighbourhoods, the median price tends to be higher in Spring, Summer, and Fall than Winter. This relationship is especially prevalent within the center-most neighbourhood, the Historic Center (Centro Historico), which turns noticeably darker in the Summer and Fall, indicating higher median Airbnb prices. Graphs similar to that which is displayed above are included in the appendix for the four other cities examined. The relationship between season and price was less obvious in the plots for Napoli and Milan, while Florence and Venice's graphs both exhibited characteristics similar to that observed in Rome's.

```{r}
#| label: guests-price
#| fig-cap: "Airbnb Log-Price Distribution by Maximum Guests Allowed"

city_data$accommodates <- factor(city_data$accommodates, levels = c(1:16))

ggplot(city_data, aes(x = accommodates, y = log_price)) +
  geom_boxplot(color = "#008C45", size = 1) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    #panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold"),
  ) +
  labs(
    title = "Distribution of Log-transformed Airbnb prices in Italy, by # of Guests Permitted",
    x = "Max. # of Guests",
    y = "Log-price"
  )
```


```{r}
#| label: rating-price
#| fig-cap: "Relationship Between Airbnb Log-Price and Guest Rating"

ggplot(city_data, aes(x = review_scores_rating, y = log_price)) +
  geom_point(color = "#CD212A", alpha = 0.1) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    #panel.grid.major = element_blank(),
    #panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold"),
  ) +
  labs(
    title = "Log-transformed Italian Airbnb prices vs. guest rating",
    x = "Guest Rating",
    y = "Log-price"
  )
```

```{r}
#| label: roomtype-price
#| fig-cap: "Airbnb Log-Price Distribution by Room Type"

city_data <- city_data |>
  mutate(room_type = case_when(room_type == "entire home/apt" ~ "Entire Home/Apartment",
                               room_type == "private room" ~ "Private Room",
                               room_type == "hotel room" ~ "Hotel Room",
                               room_type == "shared room" ~ "Shared Room"))

ggplot(city_data, aes(x = log_price)) +
  geom_density(color = "#008C45", fill = "#83F0B9", size = 1.1) +
  facet_grid(rows = vars(room_type)) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold"),
    strip.text.y = element_text(angle = 0, vjust = 0.5)
  ) +
  labs(
    title = "Distribution of Log-transformed Airbnb prices in Italy, by room type",
    x = "Log-price",
    y = "Density"
  )
```

```{r}
#| label: superhost-price
#| fig-cap: "Airbnb Log-Price Distribution by Superhost Status"

city_data <- city_data |>
  mutate(host_is_superhost = case_when(host_is_superhost == "t" ~ "Yes",
                                       host_is_superhost == "f" ~ "No"))

ggplot(city_data, aes(x = host_is_superhost, y = log_price)) +
  geom_boxplot(color = "#CD212A", size = 1) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    #panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold"),
  ) +
  labs(
    title = "Distribution of Log-transformed Airbnb prices in Italy, by superhost status",
    x = "Superhost?",
    y = "Log-price"
  )
```

```{r}
#| label: longitude-price
#| fig-cap: "Relationship Between Airbnb Log-Price and Relative Longitude/Latitude"

long_plot <- ggplot(city_data, aes(x = relative_long, y = log_price)) +
  geom_point(color = "#008C45", alpha = 0.1) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    #panel.grid.major = element_blank(),
    #panel.grid.minor = element_blank(),
    panel.border = element_blank(),
  ) +
  labs(
    #title = "Log-transformed Italian Airbnb prices vs. relative longitude and latitude",
    x = "Relative longitude",
    y = "Log-price"
  )

lat_plot <- ggplot(city_data, aes(x = relative_lat, y = log_price)) +
  geom_point(color = "#CD212A", alpha = 0.1) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    #panel.grid.major = element_blank(),
    #panel.grid.minor = element_blank(),
    panel.border = element_blank(),
  ) +
  labs(
    #title = "Log-transformed Italian Airbnb prices vs. relative latitude",
    x = "Relative latitude",
    y = ""
  )

(long_plot + lat_plot) + plot_annotation(title = "Log-transformed Italian Airbnb prices vs. relative longitude and latitude",
                                         theme = theme(plot.title = element_text(face = "bold")))
```

# 2. Methodology

## 2.1 Model and Variable Selection

```{r}
#| label: model-fitting

city_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + place + period*place + (1 | id), data = city_data)
firenze_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + (1 | id), data = firenze_data)
milano_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + (1 | id), data = milano_data)
napoli_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + (1 | id), data = napoli_data)
roma_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + (1 | id), data = roma_data)
venezia_lmer <- lmer(log_price ~ accommodates + review_scores_rating + room_type + host_is_superhost + period + relative_lat + 
                        relative_long + (1 | id), data = venezia_data)
```

This study aims to investigate the effect of seasonality on Italian Airbnb prices, providing insight into tourism trends in the country. The analysis began by considering a range of statistical models including linear regression, mixed models, quantile regression, quantile mixed models, Bayesian approaches, and robust linear mixed models. Initially, a comprehensive linear mixed model was explored, incorporating city as a fixed effect and an interaction term between city and season to capture local and temporal variations in Airbnb pricing. The model also used the listing ID as a random intercept to account for unobserved heterogeneity within listings. However, the model yielded relatively weak marginal and conditional $R^2$ values, suggesting that the model might not be effectively capturing the underlying patterns.

Consequently, the strategy was refined to fit separate linear mixed models for each of the five cities in the dataset—Florence, Milan, Naples, Rome, and Venice. Similar to the comprehensive model, each city-specific model used the listing ID as a random intercept, while the maximum guest capacity, aggregate review scores, room type, "superhost" status, relative coordinates of the listing, and the season at the time of data collection were used as the fixed effects. This approach simplified the models by reducing the number of predictors and focusing on city-specific trends, leading to more robust and interpretable results.

These variables used in the final model were selected through a combination of exploratory data analysis and domain knowledge. Variables were chosen based on their potential to explain variability in Airbnb pricing. The original plan included using the neighborhood as a predictor, but due to the inconsistent number of neighborhoods across cities and the resulting complexity, this was replaced with relative latitude and longitude measures. These measures standardized location data within each city, reducing model complexity while preserving important spatial information.

The intended response variable, price, exhibited extreme right-skewness, leading to extreme heteroscedasticity in the modeling process. A log transformation was applied to price, significantly mitigating heteroscedasticity and normalizing the distribution. This transformation was crucial for stabilizing variance and improving the interpretability of the model's output, though it did not completely eliminate heteroscedasticity. The remaining effects and their implications are discussed in Model Assumptions.

The selected model framework of a mixed linear model allows for detailed analysis of how seasonality influences Airbnb prices, adjusting for individual listing characteristics and broader geographic factors. This modeling approach enhances our understanding of pricing dynamics in the Airbnb market and provides valuable insights into factors that drive price variations.

## 2.2 Model Assumptions

For a linear mixed effect model to work, the assumptions are that the explanatory variables are related linearly to the response, the errors have constant variance, the errors are independent, the errors are Normally distributed, and there is little to no multicollinearity. For the purposes of this analysis, we are assuming that there indeed exists a linear relationship between the predictors chosen and the log of price of an Airbnb, which may or may not be true in reality. For all of the other conditions, certain visualizations and statistics were produced to inspect whether they hold true, each time being done separately for each model. All of the plots hereafter referred to are available in the appendix. To check the assumption of constant variance, a scatterplot of the fitted values versus the residual values was created. For each of the five cities, the plot of residuals against fitted values yielded horizontally spread clouds of data, with a slight fan-shape opening toward higher-fitted variables. This pattern was consistent across the cities, and is indicative of a potential violation of heteroskedasticity, a major flaw in the model. To check the assumption of independent error terms, the residual values were plotted by index to ensure no autocorrelation or seasonal patterns. These plots did not seem to cause concern for any of the 5 models. For the next condition of the errors having a Normal distribution, QQ-plots and density curves of the residuals were both output. While the density curves for the models appear normal to the naked eye, further inspection of the QQ-plots reveals the heavy-tailed nature of the distribution of residuals, and thus break from Normality. This is again a major flaw with the models fit, and was observed consistently across the five cities. Lastly, to check for the presence of multicollinearity, correlation matrices for the fixed effects were output for each model. One area of concern was high correlation between room type (in particular, private room or shared room) and maximum guests allowed. However, our correlation matrix analysis revealed that all predictors, including those of concern, had absolute correlation values of well below 0.7 - a commonly accepted threshold for a low risk of multicollinearity. 

Given the violations of homoskedasticity and normality of errors, as mentioned prior, numerous other approaches were attempted in order to reduce concerns associated with violations in model conditions. These approaches included, but were not limited to multiple linear regression, quantile regression, quantile mixed models, Bayesian approaches, and robust linear mixed models. All of these approaches were aimed at solving the issue of increasing variance of residuals at higher fitted values, leading to a heavy-tailed distribution of the residuals themselves. While these attempts were unsuccessful either due to the structure of the data (high number of random effects groups relative to the total number of observations) or limited domain knowledge to experiment fully with robust linear mixed models or Bayesian methods, there is certainly room for further improvement as will be discussed later in the report. Furthermore, all results from the model will be interpreted with caution due to the flaws in meeting the model criteria.

# 3. Results

# 4. Discussion

\newpage

# Appendix

## References

https://www.mckinsey.com/industries/travel-logistics-and-infrastructure/our-insights/now-boarding-faces-places-and-trends-shaping-tourism-in-2024

https://www.statista.com/forecasts/1000846/hotel-private-accommodation-online-bookings-by-brand-in-italy

https://www.kaggle.com/datasets/salvatoremarcello/italian-airbnb-dataset?select=airbnb.csv

https://yihui.org/knitr/options/#chunk-options

https://patchwork.data-imaginist.com/articles/guides/annotation.html

https://www.st-andrews.ac.uk/media/ceed/students/mathssupport/mixedeffectsknir.pdf

*Put citations here*

## Additional Exploratory Data Analysis

```{r}
#| label: response-distribution-original
#| fig.cap: "Airbnb Price Distribution"

ggplot(city_data, aes(x = price)) +
  geom_density(color = "#008C45", fill = "#CD212A", size = 1.2) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold") 
  ) +
  xlim(10, 2500) +
  labs(
    title = "Distribution of Airbnb prices in Italy",
    x = "Price (Euros)",
    y = "Density",
    caption = "Note: Price observations greater than 2500 (n = 447) are excluded from this plot for clarity."
  )
```

```{r}
#| label: seasonal-price-florence
#| fig.cap: "Median Airbnb Price Distribution by Neighbourhood, Season (Florence)"

ggplot(grouped_neighbourhoods_full |> filter(city == "firenze")) + 
  geom_sf(aes(fill = price_median)) +
  facet_grid(~ period) +
  scale_fill_gradient(low = "#f2d8d9", high = "#CD212A") +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold") ,
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank()
  ) +
  labs(
    title = "Neighbourhood median Airbnb price by season, Florence",
    fill = "Median Price (Euro)"
  )

```

```{r}
#| label: seasonal-price-milan
#| fig.cap: "Median Airbnb Price Distribution by Neighbourhood, Season (Milan)"

ggplot(grouped_neighbourhoods_full |> filter(city == "milano")) + 
  geom_sf(aes(fill = price_median)) +
  facet_grid(~ period) +
  scale_fill_gradient(low = "#f2d8d9", high = "#CD212A") +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold") ,
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank()
  ) +
  labs(
    title = "Neighbourhood median Airbnb price by season, Milan",
    fill = "Median Price (Euro)"
  )

```

```{r}
#| label: seasonal-price-naples
#| fig.cap: "Median Airbnb Price Distribution by Neighbourhood, Season (Naples)"

ggplot(grouped_neighbourhoods_full |> filter(city == "napoli")) + 
  geom_sf(aes(fill = price_median)) +
  facet_grid(~ period) +
  scale_fill_gradient(low = "#f2d8d9", high = "#CD212A") +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold") ,
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank()
  ) +
  labs(
    title = "Neighbourhood median Airbnb price by season, Naples",
    fill = "Median Price (Euro)"
  )

```

```{r}
#| label: seasonal-price-venice
#| fig.cap: "Median Airbnb Price Distribution by Neighbourhood, Season (Venice)"

ggplot(grouped_neighbourhoods_full |> filter(city == "venezia")) + 
  geom_sf(aes(fill = price_median)) +
  facet_grid(~ period) +
  scale_fill_gradient(low = "#f2d8d9", high = "#CD212A") +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "#FFFFFF", color = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(face = "bold") ,
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank()
  ) +
  labs(
    title = "Neighbourhood median Airbnb price by season, Venice",
    fill = "Median Price (Euro)"
  )
```


## Model Investigation

### Firenze Model

```{r}
#| label: model-checking-firenze

# model summary output
summary(firenze_lmer)

# model anova
anova(firenze_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(firenze_lmer)

# model residual vs. fitted plot
plot(fitted(firenze_lmer), resid(firenze_lmer))

# autocorrelation check plot
plot(resid(firenze_lmer))

# model qq plot
qqnorm(resid(firenze_lmer))
qqline(resid(firenze_lmer))

# model residual density plot
plot(density(resid(firenze_lmer)))
```

### Milano Model

```{r}
#| label: model-checking-milano

# model summary output
summary(milano_lmer)

# model anova
anova(milano_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(milano_lmer)

# model residual vs. fitted plot
plot(fitted(milano_lmer), resid(milano_lmer))

# autocorrelation check plot
plot(resid(milano_lmer))

# model qq plot
qqnorm(resid(milano_lmer))
qqline(resid(milano_lmer))

# model residual density plot
plot(density(resid(milano_lmer)))
```

### Napoli Model

```{r}
#| label: model-checking-napoli

# model summary output
summary(napoli_lmer)

# model anova
anova(napoli_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(napoli_lmer)

# model residual vs. fitted plot
plot(fitted(napoli_lmer), resid(napoli_lmer))

# autocorrelation check plot
plot(resid(napoli_lmer))

# model qq plot
qqnorm(resid(napoli_lmer))
qqline(resid(napoli_lmer))

# model residual density plot
plot(density(resid(napoli_lmer)))
```

### Roma Data

```{r}
#| label: model-checking-roma

# model summary output
summary(roma_lmer)

# model anova
anova(roma_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(roma_lmer)

# model residual vs. fitted plot
plot(fitted(roma_lmer), resid(roma_lmer))

# autocorrelation check plot
plot(resid(roma_lmer))

# model qq plot
qqnorm(resid(roma_lmer))
qqline(resid(roma_lmer))

# model residual density plot
plot(density(resid(roma_lmer)))
```

### Venezia Model

```{r}
#| label: model-checking-venezia

# model summary output
summary(venezia_lmer)

# model anova
anova(venezia_lmer)

# model marginal and conditional r-squared
r.squaredGLMM(venezia_lmer)

# model residual vs. fitted plot
plot(fitted(venezia_lmer), resid(venezia_lmer))

# autocorrelation check plot
plot(resid(venezia_lmer))

# model qq plot
qqnorm(resid(venezia_lmer))
qqline(resid(venezia_lmer))

# model residual density plot
plot(density(resid(venezia_lmer)))
```

